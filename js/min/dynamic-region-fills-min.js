function polygonCenter(e){for(var o,t,n,a,l=[],i=[],s=e.getPath(),r=0;r<s.length;r++)i.push(s.getAt(r).lng()),l.push(s.getAt(r).lat());return l.sort(),i.sort(),o=l[0],t=l[s.length-1],n=i[0],a=i[s.length-1],center_x=o+(t-o)/2,center_y=n+(a-n)/2,new google.maps.LatLng(center_x,center_y)}function initialize(){geocoder=new google.maps.Geocoder;var e={zoom:6,center:new google.maps.LatLng(54.897321,-2.933645),mapTypeId:google.maps.MapTypeId.ROAD,disableDefaultUI:!0,draggable:!0,scrollwheel:!0,backgroundColor_old:"#f2f7fb",backgroundColor:"#8799A7",disableDoubleClickZoom:!0,clickable:!0,maxZoom:10,minZoom:6};map=new google.maps.Map(document.getElementById("map"),e);var o=document.createElement("script"),t="SELECT geometry, rep, name FROM 1BlJA1Svax75AHjS7FNY2fS4HGflwNN9m33nV289u",n=encodeURIComponent(t),a=["https://www.googleapis.com/fusiontables/v1/query?"];a.push("sql="),a.push(n),a.push("&callback=drawMap"),a.push("&key=AIzaSyC2enzPhmc4x2OjaGTLhJQ9klt9boTUmtY"),o.src=a.join("");var l=document.getElementsByTagName("body")[0];l.appendChild(o)}function addToLegend(e,o){""==e&&(e=" - ");var t=document.getElementById("legend");t.innerHTML=t.innerHTML+'<li class="list-group-item">'+e+'<span style="background:'+colour_spectrum[o]+';" class="badge">&nbsp;</span></li>'}function constructNewCoordinates(e){var o=[],t=e.coordinates[0];for(var n in t)o.push(new google.maps.LatLng(t[n][1],t[n][0]));return o}function drawMap(e){var o=e.rows;for(i in o){var t=[],n=o[i][0].geometries,a,l,s=new google.maps.InfoWindow;if(n)for(var r in n)t.push(constructNewCoordinates(n[r]));else t=constructNewCoordinates(o[i][0].geometry);a=new google.maps.Polygon({paths:t,strokeColor:"#333",strokeOpacity:1,strokeWeight:.7,fillOpacity:.4,clickable:!0,indexID:o[i],zIndex:0}),l=options.indexOf(o[i][1]),-1===l?(options.push(o[i][1]),a.setOptions({fillColor:colour_spectrum[options.length-1],colourID:options.length-1}),count[options.length-1]=1,addToLegend(o[i][1],options.length-1)):(count[l]++,a.setOptions({fillColor:colour_spectrum[l],colourID:l})),centers[i].push(polygonCenter(a));var p=new google.maps.Marker({position:polygonCenter(a),map:map,title:options[i]});google.maps.event.addListener(a,"click",function(e){"None"!=this.indexID[1]&&(s.setContent("<strong>("+this.indexID[2]+")</strong> Your Rep is "+this.indexID[1]),s.setPosition(e.latLng),s.open(map))}),polys.push(a),a.setMap(map)}var g=new RichMarker({map:map,position:new google.maps.LatLng(55.516937,-3.259087),draggable:!1,flat:!0,anchor:RichMarkerPosition.MIDDLE,content:"<div id='custom-marker'><h2>Clare</h2></div>"}),c=new RichMarker({map:map,position:new google.maps.LatLng(53.030392,-1.412525),draggable:!1,flat:!0,anchor:RichMarkerPosition.MIDDLE,content:"<div id='custom-marker'><h2>Mark</h2></div>"}),m=new RichMarker({map:map,position:new google.maps.LatLng(50.83726,-2.358618),draggable:!1,flat:!0,anchor:RichMarkerPosition.BOTTOM,content:"<div id='custom-marker'><h2>Lee</h2></div>"});google.maps.event.addListener(map,"zoom_changed",function(){var e=map.getZoom();4>=e||e>=9?(g.setMap(null),c.setMap(null),m.setMap(null)):(g.setMap(map),c.setMap(map),m.setMap(map))}),document.getElementById("SHOW_LEGEND").removeAttribute("disabled"),document.getElementById("legend_panel").removeAttribute("style"),console.group("Summary - "+options.length+" dimensions, "+o.length+" items in total."),options.length>colour_spectrum.length&&console.warn("More options than colours! Be careful here"),console.groupCollapsed("Dimensions");for(i in options)console.log(i+". '"+options[i]+"' ("+count[i]+")");console.groupEnd(),console.groupEnd()}var colour_spectrum=["#FF5335","#B29C85","#306E73","#3B424C","#1D181F"],google,map,i,geocoder,polys=[],options=[],count=[],centeres=[],console,styles=[{featureType:"all",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"landscape",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"all",elementType:"labels",stylers:[{visibility:"off"}]}];google.maps.event.addDomListener(window,"load",initialize),$(document).ready(function(){$("#SHOW_LEGEND").click(function(){$(".right-flyout").toggleClass("slideInRight"),$(".right-flyout").toggleClass("slideOutRight"),$(this).parent().toggleClass("active")})});